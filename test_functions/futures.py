import sys
sys.path.append(".")
from funciones import sql

import concurrent.futures
import requests
from dotenv import load_dotenv
import os
import time

load_dotenv('private/.env')

api_key = os.getenv('API_KEY')
url = os.getenv('url')

global_params = {
    "wstoken": api_key,
    "moodlewsrestformat": "json"
}

resultados = [('01', 'I   ', 921, '2020-5-02-01-I   '), ('01', 'II  ', 921, '2020-5-02-01-II  '), ('01', 'III ', 921, '2020-5-02-01-III '), ('01', 'IX  ', 921, '2020-5-02-01-IX  '), ('01', 'V   ', 921, '2020-5-02-01-V   '), ('01', 'VII ', 921, '2020-5-02-01-VII '), ('01', 'X   ', 921, '2020-5-02-01-X   '), ('02', 'I   ', 922, '2020-5-04-02-I   '), ('02', 'II  ', 922, '2020-5-04-02-II  '), ('02', 'III ', 922, '2020-5-04-02-III '), ('02', 'IX  ', 922, '2020-5-04-02-IX  '), ('02', 'V   ', 922, '2020-5-04-02-V   '), ('02', 'VI  ', 922, '2020-5-04-02-VI  '), ('02', 'VII ', 922, '2020-5-04-02-VII '), ('02', 'VIII', 922, '2020-5-04-02-VIII'), ('02', 'X   ', 922, '2020-5-04-02-X   '), ('03', 'I   ', 923, '2020-5-02-03-I   '), ('03', 'II  ', 923, '2020-5-02-03-II  '), ('03', 'III ', 923, '2020-5-02-03-III '), ('03', 'IV  ', 923, '2020-5-02-03-IV  '), ('03', 'IX  ', 923, '2020-5-02-03-IX  '), ('03', 'V   ', 923, '2020-5-02-03-V   '), ('03', 'VI  ', 923, '2020-5-02-03-VI  '), ('03', 'VII ', 923, '2020-5-02-03-VII '), ('03', 'VIII', 923, '2020-5-02-03-VIII'), ('03', 'X   ', 923, '2020-5-02-03-X   '), ('04', 'I   ', 924, '2020-5-01-04-I   '), ('04', 'II  ', 924, '2020-5-01-04-II  '), ('04', 'III ', 924, '2020-5-01-04-III '), ('04', 'IV  ', 924, '2020-5-01-04-IV  '), ('04', 'IX  ', 924, '2020-5-01-04-IX  '), ('04', 'V   ', 924, '2020-5-01-04-V   '), ('04', 'VII ', 924, '2020-5-01-04-VII '), ('04', 'X   ', 924, '2020-5-01-04-X   '), ('05', 'I   ', 925, '2020-5-01-05-I   '), ('05', 'II  ', 925, '2020-5-01-05-II  '), ('05', 'III ', 925, '2020-5-01-05-III '), ('05', 'IV  ', 925, '2020-5-01-05-IV  '), ('05', 'IX  ', 925, '2020-5-01-05-IX  '), ('05', 'V   ', 925, '2020-5-01-05-V   '), ('05', 'VI  ', 925, '2020-5-01-05-VI  '), ('05', 'VII ', 925, '2020-5-01-05-VII '), ('05', 'VIII', 925, '2020-5-01-05-VIII'), ('05', 'X   ', 925, '2020-5-01-05-X   '), ('06', 'I   ', 926, '2020-5-05-06-I   '), ('06', 'II  ', 926, '2020-5-05-06-II  '), ('06', 'III ', 926, '2020-5-05-06-III '), ('06', 'IV  ', 926, '2020-5-05-06-IV  '), ('06', 'IX  ', 926, '2020-5-05-06-IX  '), ('06', 'V   ', 926, '2020-5-05-06-V   '), ('06', 'VI  ', 926, '2020-5-05-06-VI  '), ('06', 'VII ', 926, '2020-5-05-06-VII '), ('06', 'VIII', 926, '2020-5-05-06-VIII'), ('06', 'X   ', 926, '2020-5-05-06-X   '), ('07', 'I   ', 927, '2020-5-05-07-I   '), ('07', 'II  ', 927, '2020-5-05-07-II  '), ('07', 'III ', 927, '2020-5-05-07-III '), ('07', 'IX  ', 927, '2020-5-05-07-IX  '), ('07', 'V   ', 927, '2020-5-05-07-V   '), ('07', 'VI  ', 927, '2020-5-05-07-VI  '), ('07', 'VII ', 927, '2020-5-05-07-VII '), ('07', 'VIII', 927, '2020-5-05-07-VIII'), ('07', 'X   ', 927, '2020-5-05-07-X   '), ('08', 'I   ', 928, '2020-5-06-08-I   '), ('08', 'II  ', 928, '2020-5-06-08-II  '), ('08', 'III ', 928, '2020-5-06-08-III '), ('08', 'IV  ', 928, '2020-5-06-08-IV  '), ('08', 'IX  ', 928, '2020-5-06-08-IX  '), ('08', 'V   ', 928, '2020-5-06-08-V   '), ('08', 'VI  ', 928, '2020-5-06-08-VI  '), ('08', 'VII ', 928, '2020-5-06-08-VII '), ('08', 'VIII', 928, '2020-5-06-08-VIII'), ('08', 'X   ', 928, '2020-5-06-08-X   '), ('09', 'I   ', 929, '2020-5-07-09-I   '), ('09', 'II  ', 929, '2020-5-07-09-II  '), ('09', 'III ', 929, '2020-5-07-09-III '), ('09', 'IV  ', 929, '2020-5-07-09-IV  '), ('09', 'IX  ', 929, '2020-5-07-09-IX  '), ('09', 'V   ', 929, '2020-5-07-09-V   '), ('09', 'VI  ', 929, '2020-5-07-09-VI  '), ('09', 'VII ', 929, '2020-5-07-09-VII '), ('09', 'VIII', 929, '2020-5-07-09-VIII'), ('09', 'X   ', 929, '2020-5-07-09-X   '), ('10', 'I   ', 930, '2020-5-08-10-I   '), ('10', 'III ', 930, '2020-5-08-10-III '), ('10', 'V   ', 930, '2020-5-08-10-V   '), ('10', 'VI  ', 930, '2020-5-08-10-VI  '), ('10', 'VII ', 930, '2020-5-08-10-VII '), ('10', 'VIII', 930, '2020-5-08-10-VIII'), ('11', 'I   ', 931, '2020-5-08-11-I   '), ('11', 'III ', 931, '2020-5-08-11-III '), ('11', 'IV  ', 931, '2020-5-08-11-IV  '), ('11', 'V   ', 931, '2020-5-08-11-V   '), ('11', 'VII ', 931, '2020-5-08-11-VII '), ('12', 'I   ', 932, '2020-5-12-12-I   '), ('12', 'II  ', 932, '2020-5-12-12-II  '), ('12', 'III ', 932, '2020-5-12-12-III '), ('12', 'IV  ', 932, '2020-5-12-12-IV  '), ('12', 'IX  ', 932, '2020-5-12-12-IX  '), ('12', 'V   ', 932, '2020-5-12-12-V   '), ('12', 'VII ', 932, '2020-5-12-12-VII '), ('12', 'VIII', 932, '2020-5-12-12-VIII'), ('12', 'X   ', 932, '2020-5-12-12-X   '), ('13', 'I   ', 933, '2020-5-03-13-I   '), ('13', 'III ', 933, '2020-5-03-13-III '), ('13', 'IV  ', 933, '2020-5-03-13-IV  '), ('13', 'IX  ', 933, '2020-5-03-13-IX  '), ('13', 'V   ', 933, '2020-5-03-13-V   '), ('13', 'VII ', 933, '2020-5-03-13-VII '), ('13', 'X   ', 933, '2020-5-03-13-X   '), ('14', 'I   ', 934, '2020-5-12-14-I   '), ('14', 'II  ', 934, '2020-5-12-14-II  '), ('14', 'III ', 934, '2020-5-12-14-III '), ('14', 'IX  ', 934, '2020-5-12-14-IX  '), ('14', 'V   ', 934, '2020-5-12-14-V   '), ('14', 'VII ', 934, '2020-5-12-14-VII '), ('14', 'X   ', 934, '2020-5-12-14-X   '), ('15', 'I   ', 935, '2020-5-03-15-I   '), ('15', 'II  ', 935, '2020-5-03-15-II  '), ('15', 'III ', 935, '2020-5-03-15-III '), ('15', 'IX  ', 935, '2020-5-03-15-IX  '), ('15', 'V   ', 935, '2020-5-03-15-V   '), ('15', 'VII ', 935, '2020-5-03-15-VII '), ('15', 'X   ', 935, '2020-5-03-15-X   '), ('16', 'I   ', 936, '2020-5-10-16-I   '), ('16', 'III ', 936, '2020-5-10-16-III '), ('16', 'IX  ', 936, '2020-5-10-16-IX  '), ('16', 'V   ', 936, '2020-5-10-16-V   '), ('16', 'VI  ', 936, '2020-5-10-16-VI  '), ('16', 'VII ', 936, '2020-5-10-16-VII '), ('16', 'VIII', 936, '2020-5-10-16-VIII'), ('16', 'X   ', 936, '2020-5-10-16-X   '), ('16', 'XI  ', 936, '2020-5-10-16-XI  '), ('16', 'XII ', 936, '2020-5-10-16-XII '), ('18', 'E   ', 937, '2020-5-11-18-E   '), ('18', 'IX  ', 937, '2020-5-11-18-IX  '), ('18', 'X   ', 937, '2020-5-11-18-X   '), ('19', 'E   ', 945, '2020-5-11-19-E   '), ('19', 'EC  ', 945, '2020-5-11-19-EC  '), ('19', 'I   ', 945, '2020-5-11-19-I   '), ('19', 'III ', 945, '2020-5-11-19-III '), ('19', 'IX  ', 945, '2020-5-11-19-IX  '), ('19', 'V   ', 945, '2020-5-11-19-V   '), ('19', 'VII ', 945, '2020-5-11-19-VII '), ('19', 'VIII', 945, '2020-5-11-19-VIII'), ('19', 'X   ', 945, '2020-5-11-19-X   '), ('21', 'EC  ', 942, '2020-5-11-21-EC  '), ('21', 'ES  ', 942, '2020-5-11-21-ES  '), ('21', 'III ', 942, '2020-5-11-21-III '), ('21', 'IX  ', 942, '2020-5-11-21-IX  '), ('21', 'V   ', 942, '2020-5-11-21-V   '), ('21', 'VII ', 942, '2020-5-11-21-VII '), ('21', 'VIII', 942, '2020-5-11-21-VIII'), ('21', 'X   ', 942, '2020-5-11-21-X   '), ('24', 'I   ', 938, '2020-5-11-24-I   '), ('24', 'III ', 938, '2020-5-11-24-III '), ('24', 'IX  ', 938, '2020-5-11-24-IX  '), ('24', 'V   ', 938, '2020-5-11-24-V   '), ('24', 'VII ', 938, '2020-5-11-24-VII '), ('24', 'VIII', 938, '2020-5-11-24-VIII'), ('24', 'X   ', 938, '2020-5-11-24-X   '), ('25', 'I   ', 939, '2020-5-01-25-I   '), ('25', 'II  ', 939, '2020-5-01-25-II  '), ('25', 'III ', 939, '2020-5-01-25-III '), ('25', 'IX  ', 939, '2020-5-01-25-IX  '), ('25', 'V   ', 939, '2020-5-01-25-V   '), ('25', 'VII ', 939, '2020-5-01-25-VII '), ('25', 'X   ', 939, '2020-5-01-25-X   '), ('26', 'E   ', 940, '2020-5-11-26-E   '), ('28', 'E   ', 946, '2020-5-11-28-E   '), ('28', 'I   ', 946, '2020-5-11-28-I   '), ('28', 'III ', 946, '2020-5-11-28-III '), ('28', 'IX  ', 946, '2020-5-11-28-IX  '), ('28', 'V   ', 946, '2020-5-11-28-V   '), ('28', 'VII ', 946, '2020-5-11-28-VII '), ('28', 'VIII', 946, '2020-5-11-28-VIII'), ('28', 'X   ', 946, '2020-5-11-28-X   '), ('29', 'E   ', 941, '2020-5-11-29-E   '), ('29', 'ES  ', 941, '2020-5-11-29-ES  '), ('29', 'I   ', 941, '2020-5-11-29-I   '), ('29', 'III ', 941, '2020-5-11-29-III '), ('29', 'IX  ', 941, '2020-5-11-29-IX  '), ('29', 'V   ', 941, '2020-5-11-29-V   '), ('29', 'VII ', 941, '2020-5-11-29-VII '), ('29', 'VIII', 941, '2020-5-11-29-VIII'), ('29', 'X   ', 941, '2020-5-11-29-X   '), ('34', 'I   ', 943, '2020-5-11-34-I   '), ('34', 'II  ', 943, '2020-5-11-34-II  '), ('34', 'III ', 943, '2020-5-11-34-III '), ('34', 'IX  ', 943, '2020-5-11-34-IX  '), ('34', 'V   ', 943, '2020-5-11-34-V   '), ('34', 'VII ', 943, '2020-5-11-34-VII '), ('34', 'X   ', 943, '2020-5-11-34-X   '), ('35', 'I   ', 944, '2020-5-04-35-I   '), ('35', 'II  ', 944, '2020-5-04-35-II  '), ('35', 'III ', 944, '2020-5-04-35-III '), ('35', 'IV  ', 944, '2020-5-04-35-IV  '), ('35', 'IX  ', 944, '2020-5-04-35-IX  '), ('35', 'V   ', 944, '2020-5-04-35-V   '), ('35', 'VII ', 944, '2020-5-04-35-VII '), ('35', 'X   ', 944, '2020-5-04-35-X   '), ('36', 'I   ', 947, '2020-5-07-36-I   '), ('36', 'II  ', 947, '2020-5-07-36-II  '), ('36', 'III ', 947, '2020-5-07-36-III '), ('36', 'IV  ', 947, '2020-5-07-36-IV  '), ('36', 'V   ', 947, '2020-5-07-36-V   '), ('36', 'VII ', 947, '2020-5-07-36-VII '), ('36', 'VIII', 947, '2020-5-07-36-VIII')]

session = requests.Session()

def crear_sub_categoria(params):
    response = session.post(f"{url}", params=params).json()
    return response

def crear_cat_ciclos():
    try:
        list_params = [{
            "wsfunction": "core_course_create_categories",
            "categories[0][name]": resultado[1],
            "categories[0][idnumber]": resultado[3],
            "categories[0][description]": resultado[1],
            "categories[0][parent]": resultado[2]
        } for resultado in resultados]
        params_list = [{**global_params, **params} for params in list_params]

        with concurrent.futures.ThreadPoolExecutor() as executor:
            responses = list(executor.map(crear_sub_categoria, params_list))

        # return responses
        for response in responses:
            data = {'numeracion': response[0]['name'], 'parent': response[0]['id']}
            sql.insertar_datos('sva.le_ciclo', data)
    
    except Exception as e:
        return f'Fallaste {e}'


inicio = time.time()
crear_cat_ciclos()
fin = time.time()

print(f"Tiempo de ejecución: {fin - inicio} segundos")